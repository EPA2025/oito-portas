<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Demon Marker - AR</title>

  <!-- Scripts AR.js -->
  <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

  <!-- Estilos -->
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    #intro {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background:black; color:white; z-index:10000;
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      padding:20px; text-align:center; font-family:Georgia, serif; line-height:1.6; overflow-y:auto;
    }
    #intro h1 { font-size:2em; margin-bottom:20px; }
    #intro p { max-width:700px; margin-bottom:15px; }
    #intro button {
      margin-top:20px; padding:12px 24px; font-size:1em;
      background:darkred; color:white; border:none; border-radius:8px; cursor:pointer;
    }
    #intro button:hover { background:crimson; }
  </style>
</head>

<body>
  <!-- Tela de introdução -->
  <div id="intro">
    <h1>Demon Marker</h1>
    <p>Este é um teste de AR com o modelo do demônio rastejante. Aponte a câmera para o marcador para ver a criatura aparecer e se aproximar.</p>
    <button onclick="startAR()">Iniciar AR</button>
  </div>

  <!-- Cena AR -->
  <a-scene
    id="scene"
    style="display:none;"
    vr-mode-ui="enabled: false;"
    embedded
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
  >

    <!-- Marcador NFT -->
    <a-nft
      type="nft"
      url="https://juliamaciels.github.io/oito-portas/demon-marker/marcadores/demon-marker"
      smooth="true"
      smoothCount="10"
      smoothTolerance=".01"
      smoothThreshold="5"
    >
      <!-- Grupo do modelo -->
      <a-entity id="demonRoot" position="0 0 0.4" scale="0.6 0.6 0.6">
        <!-- Modelo 3D com animação -->
        <a-entity
          id="demonModel"
          gltf-model="https://juliamaciels.github.io/oito-portas/demon-marker/modelos/demon-marker.glb"
          rotation="0 180 0"
          animation-mixer
        ></a-entity>
      </a-entity>
    </a-nft>

    <!-- Câmera -->
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    function startAR() {
      document.getElementById("intro").style.display = "none";
      document.getElementById("scene").style.display = "block";
    }

    const marker = document.querySelector('a-nft');
    const demonRoot = document.getElementById('demonRoot');

    // Função de aproximação quando o marcador é detectado
    function approachDemon() {
      demonRoot.setAttribute('animation__approach', 
        'property: position; to: 0 0 0.1; dur: 1500; easing: easeOutQuad;');
      setTimeout(() => {
        demonRoot.setAttribute('animation__grab', 
          'property: position; to: 0 -0.08 0.1; dur: 500; dir: alternate; loop: 2;');
      }, 1500);
    }

    marker.addEventListener('markerFound', () => {
      console.log('Marcador detectado!');
      approachDemon();
    });

    marker.addEventListener('markerLost', () => {
      console.log('Marcador perdido.');
      demonRoot.setAttribute('position', '0 0 0.4');
      demonRoot.removeAttribute('animation__approach');
      demonRoot.removeAttribute('animation__grab');
    });
  </script>
</body>
</html>
